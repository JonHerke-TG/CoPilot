FROM continuumio/miniconda3

RUN apt-get update && \
    apt-get install -y build-essential

RUN conda create -n py39 python=3.9 pip -y && \
    conda init bash

SHELL ["/bin/bash", "--login", "-c"]

# 
WORKDIR /code

# 
COPY ./requirements.txt /code/requirements.txt

# 
RUN conda run -n py39 pip install --no-cache-dir --upgrade -r /code/requirements.txt && \
    conda run -n py39 conda install faiss-cpu -c pytorch -y

# 
COPY ./app /code/app
COPY ./tests /code/tests

COPY ./.git /code/.git

# INFO, DEBUG, DEBUG_PII
ENV LOGLEVEL="INFO"

WORKDIR /code/tests
